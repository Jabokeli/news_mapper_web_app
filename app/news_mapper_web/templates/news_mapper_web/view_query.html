
{% extends 'news_mapper_web/base.html' %}


{% block title %}Query Results - {{ block.super }}{% endblock %}

{% block scripts %}

    {{ block.super }}

    <script>
            //let doc = $("#choropleth-p")[0].contentWindow.document;
           // let doc = $("#choropleth-p")[0].contentWindow.MapWidget;
            //doc.open();
            //doc.write("{ news_query.choro_html|safe }}")
            // let iframe = ($("#choro-iframe")[0]).html({ news_query.choro_html|safe }})
            //$(document.getElementById("#choro-iframe")[0].html({ news_query.choro_html|safe }}));
        //https://stackoverflow.com/questions/494143/creating-a-new-dom-element-from-an-html-string-using-built-in-dom-methods-or-pro
        //https://stackoverflow.com/questions/2781003/how-to-insert-html-in-iframe
        import * as parent from "../../../../venv/Lib/site-packages/notebook/static/components/backbone/backbone-min";

        function htmlToTemplate(html) {
            let template = document.createElement('template');
            let temp = document.getElementById('#choro-temp');
            html = html.trim();
            template.innerHTML = html;
            temp.innerHTML = html;
            return (template.content.childNodes);
        }

        function htmlToIframe(html) {
            let iframe = document.getElementById('#choro-iframe');
            let html_slice = html.slice(15,-1);  {% comment %}Removing <!DOCTYPE html>{% endcomment %}
            let html_tag = '<html lang="en">';
            let new_html = html_tag.concat(' ', html_slice);
            $(iframe).load(new_html);
        }
    $(document).ready(function() {
        htmlToTemplate({{ query.choro_html|safe }});
        htmlToIframe({{ query.choro_html|safe }});
    });

{#    let d1 = document.getElementById('#adjacent-target');#}
{#    d1.insertAdjacentHTML('afterend', {{ news_query.choro_html|safe }})#}

    </script>

{% endblock %}


{% block content %}

    <iframe id="choro-iframe"></iframe>
    <div class="container">
        <div class="row">
            <div class="col-*-7">
                <h2>Query Details</h2>
                <p id="adjacent-target">
                    ARGUMENT: {{ query.argument }}
                    TYPE: {{ query.query_type }}
                    DATE: {{ query.date_created }}
                </p>
            </div>
            {% if request.user.pk == user.pk %}
                {% if query.saved is False %}
                    <div>
                        <form method="post" action="{% url 'new_post' %}">
                            {% csrf_token %}
                            <div class="input-group">
                                <div class="form-check form-check-inline">
                                    <label class="form-check-label"> Private
                                        <input type="radio" class="form-check-input" id="private-save-false" name="save_radio" checked>
                                    </label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <label class="form-check-label"> Public
                                        <input type="radio" class="form-check-input" id="public-save-false" name="save_radio">
                                    </label>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-default">Post Query</button>
                            <input type="hidden" name="user_pk" value="{{ user.pk }}">
                            <input type="hidden" name="query_pk" value="{{ query.pk }}">
                        </form>
                        <form method="post" action="{% url 'delete_query' query.pk %}">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-danger">Delete Query</button>
                        </form>
                    </div>
                {% endif %}
                {% if query.saved is True %}
                    <form method="post" action="{% url 'update_post' post.pk %}">
                        {% csrf_token %}
                        <div class="input-group">
                            <div class="form-check form-check-inline">
                                <label class="form-check-label"> Private
                                    <input type="radio" class="form-check-input" id="private-save-true" name="save_radio" checked>
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <label class="form-check-label"> Public
                                    <input type="radio" class="form-check-input" id="public-save-true" name="save_radio">
                                </label>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-default">Update Post</button>
                        <input type="hidden" name="user_pk" value="{{ user.pk }}">
                        <input type="hidden" name="query_pk" value="{{ query.pk }}">
                    </form>
                    <form method="post" action="{% url 'delete_post' post.pk %}">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-danger">Delete Post</button>
                        <sub>* Query will also be deleted</sub>
                    </form>
                {% endif %}
            {% endif %}

            <div class="col-5">
                <ul>
                    {% for article in query.articles|slice:20 %}
                        {% if article %}
                            <li class="article-list">
                                <p>Title: {{ article.title }}</p>
                                <sub>
                                    Author: {{ article.author }} --
                                    Published: {{ article.get_date_published }}
                                </sub>
                                <blockquote class="article-desc">{{ article.description }}</blockquote>
                                <sub><a href="{{ article.article_url }}">Link to Original</a></sub>
                            </li>
                        {% endif %}
                    {% empty %}
                        <li>No Articles Found for Query</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>

{% endblock %}