FROM continuumio/miniconda3

ENV PYTHONUNBUFFERED 1
ENV PYTHONDONTWRITEBYTECODE 1
ENV SECRET_KEY=dlt$aysys8tmwkasdfg429m_-=6$f%#y3@lkqy@m1e
ENV HEROKU_POSTGRESQL_IVORY_URL=postgres://cxvqfbfscxwues:20ddf628049810e9cffb82576e940a216b62ecc52eeae943f707cc73000e2d53@ec2-54-83-50-145.compute-1.amazonaws.com:5432/d79uk8s0d0qu1g
ENV NEWS_MAPPER_KEY=dlt$aysys8tmwkasdfg429m_-=6$f%#y3@lkqy@m1e
ENV PAPERTRAIL_API_TOKEN=giqLhP1yEgHBrWa4Fxr1

ENTRYPOINT ["/bin/bash", "-c"]

COPY start.sh /start.sh
COPY . /code
WORKDIR /code
ADD . /code

RUN rm /bin/sh && ln -s /bin/bash /bin/sh

RUN apt-get update && apt-get install -y && apt-get install build-essential libssl-dev -y && rm -rf /var/lib/apt/lists/*

RUN conda create --name news_mapper_django_docker python=3

EXPOSE 8000

ENV NAME World

# CMD ["source activate news_mapper_django_docker && exec conda install GDAL Fiona pyproj && exec pip install --trusted-host pypi.python.org -r requirements.txt"]
CMD ["source activate news_mapper_django_docker && exec conda install GDAL Fiona pyproj && exec pip install --trusted-host pypi.python.org -r requirements.txt && exec python manage.py makemigrations && exec python manage.py migrate && exec python manage.py runserver && exec start.sh"]
